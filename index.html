<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>hypixel-checker</title>
    <style>
      code {
        font-family: Consolas, Menlo, Monaco, Lucida Console, Liberation Mono,
          DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace,
          serif;
      }
    </style>
    <script src="config.js"></script>
    <script>
      const INFO = {
        VERSION_NUMBER: "1.0.0",
        VERSION_HASH: require("child_process")
          .execSync("git rev-parse HEAD")
          .toString()
          .trim(),
      };
      window.onload = () => {
        const createLine = ({ text, color = "white" }) => {
          let div = document.createElement("div");
          let code = document.createElement("code");
          code.innerHTML = text;
          code.style.color = color;
          div.appendChild(code);

          document.getElementById("terminal").appendChild(div);
        };
        const axios = require("axios");
        const path = require("path");
        const { app, BrowserWindow } = require("electron");
        let LAST_KNOWN_LOGIN;
        createLine({ text: "hypixel-checker", color: "aquamarine" });
        setInterval(
          () => {
            axios
              .get(`https://api.hypixel.net/player`, {
                params: {
                  key: CONFIG.API_KEY,
                  name: CONFIG.USERNAME,
                },
              })
              .then((res) => {
                const lastLogin = res.data.player.lastLogin;
                if (LAST_KNOWN_LOGIN == undefined) LAST_KNOWN_LOGIN = lastLogin;
                else if (LAST_KNOWN_LOGIN != lastLogin) {
                  if (CONFIG.NOTIFICATIONS)
                    new Notification("hypixel-checker", {
                      body: `Login Detected at ${new Date(
                        lastLogin
                      ).toLocaleString()}`,
                      icon: path.join(__dirname, "icon.png"),
                    });

                  LAST_KNOWN_LOGIN = res.data.player.lastLogin;
                  createLine({
                    text: `Login Detected at <span style="color:red;">${new Date(
                      lastLogin
                    ).toLocaleString()}</span>`,
                  });
                }
              })
              .catch((err) => {
                console.log(err);
                createLine({
                  text: `An error has occured: ${err.response.data.cause}`,
                  color: "red",
                });
              });
          },
          CONFIG.CHECK_FREQUENCY > 0.5 ? CONFIG.CHECK_FREQUENCY * 1000 : 500
        );
      };
    </script>
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
  </head>
  <body style="background: black">
    <pre id="terminal"></pre>
  </body>
</html>
